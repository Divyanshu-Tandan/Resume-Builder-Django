{% extends 'base.html' %}

{% block title %}Create Resume{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <!-- Form Column -->
            <div class="col-md-6">
                <h2>Create Resume</h2>
                <form method="post" id="resumeForm">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-primary">Save Resume</button>
                    <a href="{% url 'resume_list' %}" class="btn btn-secondary">Cancel</a>
                </form>
            </div>
            <!-- Preview Column -->
            <div class="col-md-6">
                <h2>Preview</h2>
                <div class="resume-preview" style="border: 1px solid #ddd; padding: 0.5in; background-color: #fff; height: 80vh; overflow-y: auto;">
                    <h3 style="font-weight: bold; color: #2c3e50; border-bottom: 1px solid #ddd; padding-bottom: 5px;" id="preview-title">{{ form.title.value|default:"Untitled Resume" }}</h3>
                    <p><strong>Full Name:</strong> <span id="preview-full-name">{{ form.full_name.value|default:"Not provided" }}</span></p>
                    <p><strong>Email:</strong> <span id="preview-email">{{ form.email.value|default:"Not provided" }}</span></p>
                    <p><strong>Phone:</strong> <span id="preview-phone">{{ form.phone.value|default:"Not provided" }}</span></p>
                    <p><strong>Address:</strong> <pre id="preview-address">{{ form.address.value|default:"Not provided" }}</pre></p>
                    <h3 style="font-weight: bold; color: #2c3e50; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Personal Information:</h3>
                    <p><pre id="preview-personal-info">{{ form.personal_info.value|default:"No personal info provided" }}</pre></p>
                    <h3 style="font-weight: bold; color: #2c3e50; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Summary:</h3>
                    <p><pre id="preview-summary">{{ form.summary.value|default:"No summary provided" }}</pre></p>
                    <h3 style="font-weight: bold; color: #2c3e50; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Education:</h3>
                    <p><pre id="preview-education">{{ form.education.value|default:"No education provided" }}</pre></p>
                    <h3 style="font-weight: bold; color: #2c3e50; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Experience:</h3>
                    <p><pre id="preview-experience">{{ form.experience.value|default:"No experience provided" }}</pre></p>
                    <h3 style="font-weight: bold; color: #2c3e50; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Skills:</h3>
                    <p><pre id="preview-skills">{{ form.skills.value|default:"No skills provided" }}</pre></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('resumeForm');
            const previewElements = {
                'title': document.getElementById('preview-title'),
                'full_name': document.getElementById('preview-full-name'),
                'email': document.getElementById('preview-email'),
                'phone': document.getElementById('preview-phone'),
                'address': document.getElementById('preview-address'),
                'personal_info': document.getElementById('preview-personal-info'),
                'summary': document.getElementById('preview-summary'),
                'education': document.getElementById('preview-education'),
                'experience': document.getElementById('preview-experience'),
                'skills': document.getElementById('preview-skills')
            };

            form.querySelectorAll('input, textarea').forEach(input => {
                input.addEventListener('input', function() {
                    const fieldName = this.name;
                    const previewElement = previewElements[fieldName] || previewElements[fieldName.replace('-', '_')];
                    if (previewElement) {
                        if (fieldName === 'title') {
                            previewElement.textContent = this.value || 'Untitled Resume';
                        } else if (fieldName === 'address' || fieldName === 'personal_info' || fieldName === 'summary' || 
                                   fieldName === 'education' || fieldName === 'experience' || fieldName === 'skills') {
                            previewElement.textContent = this.value || (fieldName === 'skills' ? 'No skills provided' : 'No ' + fieldName.replace('_', ' ') + ' provided');
                        } else {
                            previewElement.textContent = this.value || 'Not provided';
                        }
                    }
                });
            });
        });
    </script>
{% endblock %}